{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/upload/./src/common/mimeToIcon.js","webpack://@fof/upload/./src/common/models/File.js","webpack://@fof/upload/./src/forum/addUploadButton.js","webpack://@fof/upload/./src/forum/components/DragAndDrop.js","webpack://@fof/upload/./src/forum/components/FileManagerButton.js","webpack://@fof/upload/./src/forum/components/FileManagerModal.js","webpack://@fof/upload/./src/forum/components/PasteClipboard.js","webpack://@fof/upload/./src/forum/components/UploadButton.js","webpack://@fof/upload/./src/forum/components/UploadsUserPage.js","webpack://@fof/upload/./src/forum/components/UserFileList.js","webpack://@fof/upload/./src/forum/components/index.js","webpack://@fof/upload/./src/forum/downloadButtonInteraction.js","webpack://@fof/upload/./src/forum/handler/Uploader.js","webpack://@fof/upload/./src/forum/index.js","webpack://@fof/upload/./src/forum/states/FileListState.js","webpack://@fof/upload/external root \"flarum.core.compat['common/Component']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/Model']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/components/Alert']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/components/Button']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/models/User']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@fof/upload/external root \"flarum.core.compat['common/utils/mixin']\"","webpack://@fof/upload/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/upload/external root \"flarum.core.compat['forum/components/Post']\"","webpack://@fof/upload/external root \"flarum.core.compat['forum/components/UserPage']\"","webpack://@fof/upload/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/upload/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/upload/webpack/bootstrap","webpack://@fof/upload/webpack/runtime/compat get default export","webpack://@fof/upload/webpack/runtime/define property getters","webpack://@fof/upload/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/upload/webpack/runtime/make namespace object","webpack://@fof/upload/./forum.js"],"sourcesContent":["const image = ['image/png', 'image/jpg', 'image/jpeg', 'image/svg+xml', 'image/gif'];\nconst archive = ['application/zip', 'application/x-7z-compressed', 'application/gzip', 'application/vnd.rar', 'application/x-rar-compressed'];\nconst code = ['text/html', 'text/css', 'text/javascript', 'application/json', 'application/ld+json', 'text/javascript', 'application/x-httpd-php'];\nconst word = [\n  'application/x-abiword',\n  'application/msword',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  'application/pdf',\n];\n\n/**\n * Returns a FontAwesome icon class for a specified MIME type.\n *\n * If it's a known image type, it returns `image` instead.\n *\n * @param {string} fileType MIME type\n * @returns {string} Icon for MIME type\n */\nexport default function mimeToIcon(fileType) {\n  // Display image (do not display for)\n  if (image.includes(fileType)) {\n    return 'image';\n  }\n  // Display image icon for other types\n  else if (fileType.includes('image/')) {\n    return 'far fa-file-image';\n  }\n  // Video icon\n  else if (fileType.includes('video/')) {\n    return 'far fa-file-video';\n  }\n  // Archive icon\n  else if (archive.indexOf(fileType) >= 0) {\n    return 'far fa-file-archive';\n  }\n  // PDF icon\n  else if (fileType === 'application/pdf') {\n    return 'far fa-file-pdf';\n  }\n  // Word\n  else if (word.indexOf(fileType) >= 0) {\n    return 'far fa-file-word';\n  }\n  // Audio icon\n  else if (fileType.includes('audio/')) {\n    return 'far fa-file-audio';\n  }\n  // Code files\n  else if (code.indexOf(fileType) >= 0) {\n    return 'far fa-file-code';\n  }\n\n  return 'far fa-file';\n}\n","import Model from 'flarum/common/Model';\nimport mixin from 'flarum/common/utils/mixin';\n\nexport default class File extends mixin(Model, {\n  baseName: Model.attribute('baseName'),\n  path: Model.attribute('path'),\n  url: Model.attribute('url'),\n  type: Model.attribute('type'),\n  size: Model.attribute('size'),\n  humanSize: Model.attribute('humanSize'),\n  createdAt: Model.attribute('createdAt'),\n  uuid: Model.attribute('uuid'),\n  tag: Model.attribute('tag'),\n  hidden: Model.attribute('hidden'),\n  bbcode: Model.attribute('bbcode'),\n}) {\n  /**\n   * Use FoF Uploads endpoint\n   */\n  apiEndpoint() {\n    return '/fof/uploads' + (this.exists ? '/' + this.data.id : '');\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport TextEditor from 'flarum/common/components/TextEditor';\nimport UploadButton from './components/UploadButton';\nimport DragAndDrop from './components/DragAndDrop';\nimport PasteClipboard from './components/PasteClipboard';\nimport Uploader from './handler/Uploader';\nimport FileManagerButton from './components/FileManagerButton';\n\nexport default function () {\n  extend(TextEditor.prototype, 'oninit', function () {\n    this.uploader = new Uploader();\n  });\n  extend(TextEditor.prototype, 'controlItems', function (items) {\n    if (!app.forum.attribute('fof-upload.canUpload')) return;\n\n    const composerButtonVisiblity = app.forum.attribute('fof-upload.composerButtonVisiblity');\n\n    // Add media button\n    if (composerButtonVisiblity === 'both' || composerButtonVisiblity === 'media-btn') {\n      items.add(\n        'fof-upload-media',\n        FileManagerButton.component({\n          uploader: this.uploader,\n        })\n      );\n    }\n\n    // Add upload button\n    if (composerButtonVisiblity === 'both' || composerButtonVisiblity === 'upload-btn') {\n      items.add(\n        'fof-upload',\n        UploadButton.component({\n          uploader: this.uploader,\n        })\n      );\n    }\n  });\n\n  extend(TextEditor.prototype, 'oncreate', function (f_, vnode) {\n    if (!app.forum.attribute('fof-upload.canUpload')) return;\n\n    this.uploader.on('success', ({ file, addBBcode }) => {\n      if (!addBBcode) return;\n//Brutal fix by edge\n      if (this.attrs.composer.editor.getLastNChars(1) == '\\n' || this.attrs.composer.editor.getLastNChars(1) == '') {\n          if (this.attrs.composer.editor.getLastNChars(1) == '') {\n              this.attrs.composer.editor.insertAtCursor('\\n', false);\n          }\n          this.attrs.composer.editor.insertAtCursor(file.bbcode() + '\\n', false);\n      }\n      else {\n          this.attrs.composer.editor.insertAtCursor(' ', true);\n          this.attrs.composer.editor.insertAtCursor('\\n' + file.bbcode() + '\\n', false);\n      }\n      \n\n      // We wrap this in a typeof check to prevent it running when a user\n      // is creating a new discussion. There's nothing to preview in a new\n      // discussion, so the `preview` function isn't defined.\n      if (typeof this.attrs.preview === 'function') {\n        // Scroll the preview into view\n        // preview() causes the composer to close on mobile, but we don't want that. We want only the scroll\n        // We work around that by temporarily patching the isFullScreen method\n        const originalIsFullScreen = app.composer.isFullScreen;\n\n        app.composer.isFullScreen = () => false;\n\n        this.attrs.preview();\n\n        app.composer.isFullScreen = originalIsFullScreen;\n      }\n    });\n\n    // Gracefully fail if the TextEditor was used in a non-Composer context\n    // Using a custom method to retrieve the target allows other extensions to still use this feature by returning an alternate container\n    const dragAndDropTarget = this.fofUploadDragAndDropTarget();\n\n    if (dragAndDropTarget) {\n      this.dragAndDrop = new DragAndDrop((files) => this.uploader.upload(files), dragAndDropTarget);\n    }\n\n    new PasteClipboard((files) => this.uploader.upload(files), this.$('.TextEditor-editor')[0]);\n  });\n\n  extend(TextEditor.prototype, 'onremove', function (f_, vnode) {\n    if (!app.forum.attribute('fof-upload.canUpload')) return;\n\n    if (this.dragAndDrop) {\n      this.dragAndDrop.unload();\n    }\n  });\n\n  TextEditor.prototype.fofUploadDragAndDropTarget = function () {\n    return this.$().parents('.Composer')[0];\n  };\n}\n","export default class DragAndDrop {\n  constructor(upload, composerElement) {\n    this.upload = upload;\n    this.composerElement = composerElement;\n\n    // Keep references to the bound methods so we can remove the event listeners later\n    this.handlers = {};\n\n    if (!this.supportsFileDragging()) {\n      return;\n    }\n\n    this.composerElement.addEventListener('dragover', (this.handlers.in = this.in.bind(this)));\n\n    this.composerElement.addEventListener('dragleave', (this.handlers.out = this.out.bind(this)));\n    this.composerElement.addEventListener('dragend', this.handlers.out);\n\n    this.composerElement.addEventListener('drop', (this.handlers.dropping = this.dropping.bind(this)));\n  }\n\n  supportsFileDragging() {\n    // Based on https://css-tricks.com/drag-and-drop-file-uploading/\n    const div = document.createElement('div');\n\n    return ('draggable' in div || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\n  }\n\n  unload() {\n    // If the handlers were not set (drag and drop not supported), we skip removing them\n    if (!this.handlers.in) {\n      return;\n    }\n\n    this.composerElement.removeEventListener('dragover', this.handlers.in);\n\n    this.composerElement.removeEventListener('dragleave', this.handlers.out);\n    this.composerElement.removeEventListener('dragend', this.handlers.out);\n\n    this.composerElement.removeEventListener('drop', this.handlers.dropping);\n  }\n\n  isNotFile(event) {\n    // Checking event.dataTransfer.files.length does not work on dragover event, it's always zero\n    // So we use the dataTransfer.items property to check whether any file is being dragged\n    if (event.dataTransfer.items) {\n      for (let i = 0; i < event.dataTransfer.items.length; i++) {\n        if (event.dataTransfer.items[i].kind !== 'file') {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  in(event) {\n    if (this.isNotFile(event)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (!this.over) {\n      this.composerElement.classList.add('fof-upload-dragging');\n      this.over = true;\n    }\n  }\n\n  out(event) {\n    if (this.isNotFile(event)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (this.over) {\n      this.composerElement.classList.remove('fof-upload-dragging');\n      this.over = false;\n    }\n  }\n\n  dropping(event) {\n    if (this.isNotFile(event)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    this.upload(event.dataTransfer.files);\n\n    this.composerElement.classList.remove('fof-upload-dragging');\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport FileManagerModal from './FileManagerModal';\nimport Tooltip from 'flarum/common/components/Tooltip';\n\nexport default class FileManagerButton extends Component {\n  view() {\n    return (\n      <Tooltip text={app.translator.trans('fof-upload.forum.buttons.media')}>\n        {Button.component({\n          className: 'Button fof-upload-button Button--icon',\n          onclick: this.fileManagerButtonClicked.bind(this),\n          icon: 'fas fa-file-check',\n        })}\n      </Tooltip>\n    );\n  }\n\n  /**\n   * Event handler for upload button being clicked\n   *\n   * @param {PointerEvent} e\n   */\n  fileManagerButtonClicked(e) {\n    e.preventDefault();\n\n    // Open dialog\n    app.modal.show(FileManagerModal, {\n      uploader: this.attrs.uploader,\n    });\n  }\n}\n","import Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport UploadButton from './UploadButton';\nimport UserFileList from './UserFileList';\nimport DragAndDrop from './DragAndDrop';\n\nexport default class FileManagerModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    // Initialize upload managers\n    this.uploader = vnode.attrs.uploader;\n\n    // Current selected files\n    this.selectedFiles = [];\n\n    // Allow multiselect\n    this.multiSelect = vnode.attrs.multiSelect || true;\n\n    // Restrict file selection to specific types\n    this.restrictFileType = vnode.attrs.restrictFileType || null;\n\n    // Drag & drop\n    this.dragDrop = null;\n\n    // Initialize uploads\n    this.onUpload();\n  }\n\n  className() {\n    return 'Modal--large fof-file-manager-modal';\n  }\n\n  /**\n   * Initialize drag & drop\n   */\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    this.dragDrop = new DragAndDrop((files) => this.uploader.upload(files, false), this.$().find('.Modal-content')[0]);\n  }\n\n  /**\n   * Remove events from modal content\n   */\n  onremove() {\n    if (this.dragDrop) {\n      this.dragDrop.unload();\n    }\n  }\n\n  view() {\n    const fileCount = this.selectedFiles.length;\n\n    return (\n      <div className={`Modal modal-dialog ${this.className()}`}>\n        <div className=\"Modal-content\">\n          <div className=\"fof-modal-buttons App-backControl\">\n            <UploadButton uploader={this.uploader} disabled={app.fileListState.isLoading()} isMediaUploadButton />\n          </div>\n\n          <div className=\"fof-drag-and-drop\">\n            <div className=\"fof-drag-and-drop-release\">\n              <i className=\"fas fa-cloud-upload-alt\" />\n\n              {app.translator.trans('fof-upload.forum.file_list.release_to_upload')}\n            </div>\n          </div>\n\n          <div className=\"Modal-header\">\n            <h3 className=\"App-titleControl App-titleControl--text\">{app.translator.trans('fof-upload.forum.media_manager')}</h3>\n          </div>\n\n          {this.alertAttrs && (\n            <div className=\"Modal-alert\">\n              <Alert {...this.alertAttrs} />\n            </div>\n          )}\n\n          <div className=\"Modal-body\">\n            <UserFileList\n              user={this.attrs.user}\n              selectable\n              onFileSelect={this.onFileSelect.bind(this)}\n              selectedFiles={this.selectedFiles}\n              restrictFileType={this.restrictFileType}\n            />\n          </div>\n\n          <div className=\"Modal-footer\">\n            <Button onclick={this.hide.bind(this)} className=\"Button\">\n              {app.translator.trans('fof-upload.forum.buttons.cancel')}\n            </Button>\n\n            <Button\n              onclick={this.onSelect.bind(this)}\n              disabled={this.selectedFiles.length === 0 || (!this.multiSelect && this.selectedFiles.length > 1)}\n              className=\"Button Button--primary\"\n            >\n              {app.translator.trans('fof-upload.forum.file_list.confirm_selection_btn', { fileCount })}\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Add or remove file from selected files\n   *\n   * @param {File} file\n   */\n  onFileSelect(file) {\n    const itemPosition = this.selectedFiles.indexOf(file.id());\n\n    if (itemPosition >= 0) {\n      this.selectedFiles.splice(itemPosition, 1);\n    } else {\n      if (this.multiSelect) {\n        this.selectedFiles.push(file.id());\n      } else {\n        this.selectedFiles = [file.id()];\n      }\n    }\n  }\n\n  /**\n   * Add files to file list after upload\n   */\n  onUpload() {\n    this.uploader.on('success', ({ file }) => {\n      if (this.multiSelect) {\n        this.selectedFiles.push(file.id());\n      } else {\n        this.selectedFiles = [file.id()];\n      }\n    });\n  }\n\n  /**\n   * Add selected files to the composer\n   */\n  onSelect() {\n    this.hide();\n\n    // Custom callback\n    if (this.attrs.onSelect) {\n      this.attrs.onSelect(this.selectedFiles);\n\n      return;\n    }\n\n    // Add selected files to composer\n    this.selectedFiles.map((fileId) => {\n      const file = app.store.getById('files', fileId);\n//Brutal fix by edge\n      if (app.composer.editor.getLastNChars(1) == '\\n' || app.composer.editor.getLastNChars(1) == '') {\n          if (app.composer.editor.getLastNChars(1) == '') {\n              app.composer.editor.insertAtCursor('\\n', false);\n          }\n          app.composer.editor.insertAtCursor(file.bbcode() + '\\n', false);\n      }\n      else {\n          app.composer.editor.insertAtCursor(' ', true);\n          app.composer.editor.insertAtCursor(file.bbcode() + '\\n', false);\n      }\n    });\n  }\n}\n","export default class PasteClipboard {\n  constructor(upload, element) {\n    this.upload = upload;\n\n    // We don't need to remove the events listeners, because they'll get removed when the DOM does.\n    element.addEventListener('paste', this.paste.bind(this));\n  }\n\n  paste(e) {\n    if (e.clipboardData && e.clipboardData.items) {\n      const items = e.clipboardData.items;\n\n      const files = [];\n\n      for (let i = 0; i < items.length; i++) {\n        if (items[i].type.indexOf('image') !== -1) {\n          files.push(items[i].getAsFile());\n        }\n      }\n\n      if (files.length > 0) {\n        e.preventDefault();\n\n        this.upload(files);\n      }\n    }\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport classList from 'flarum/common/utils/classList';\nimport Tooltip from 'flarum/common/components/Tooltip';\n\nexport default class UploadButton extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.attrs.uploader.on('uploaded', () => {\n      // reset the button for a new upload\n      this.$('form')[0].reset();\n\n      // redraw to reflect uploader.loading in the DOM\n      m.redraw();\n    });\n\n    this.isMediaUploadButton = vnode.attrs.isMediaUploadButton || false;\n  }\n\n  view() {\n    const buttonText = this.attrs.uploader.uploading\n      ? app.translator.trans('fof-upload.forum.states.loading')\n      : app.translator.trans('fof-upload.forum.buttons.upload');\n\n    return (\n      <Tooltip text={buttonText}>\n        <Button\n          className={classList([\n            'Button',\n            'hasIcon',\n            'fof-upload-button',\n            /*!this.isMediaUploadButton && !this.attrs.uploader.uploading && */'Button--icon',\n            //!this.isMediaUploadButton && !this.attrs.uploader.uploading && 'Button--link',\n            this.attrs.uploader.uploading && 'uploading',\n          ])}\n          icon={!this.attrs.uploader.uploading && 'fas fa-file-upload'}\n          onclick={this.uploadButtonClicked.bind(this)}\n          disabled={this.attrs.disabled}\n        >\n          {this.attrs.uploader.uploading && <LoadingIndicator size=\"small\" display=\"inline\" className=\"Button-icon\" />}\n          {(this.isMediaUploadButton || this.attrs.uploader.uploading) && <span className=\"Button-label\">{buttonText}</span>}\n          <form>\n            <input type=\"file\" multiple={true} onchange={this.process.bind(this)} />\n          </form>\n        </Button>\n      </Tooltip>\n    );\n  }\n\n  /**\n   * Process the upload event.\n   *\n   * @param e\n   */\n  process(e) {\n    // get the file from the input field\n    const files = this.$('input').prop('files');\n\n    if (files.length === 0) {\n      // We've got no files to upload, so trying\n      // to begin an upload will show an error\n      // to the user.\n      return;\n    }\n\n    this.attrs.uploader.upload(files, !this.isMediaUploadButton);\n  }\n\n  /**\n   * Event handler for upload button being clicked\n   *\n   * @param {PointerEvent} e\n   */\n  uploadButtonClicked(e) {\n    // Trigger click on hidden input element\n    // (Opens file dialog)\n    this.$('input').click();\n  }\n}\n","import app from 'flarum/forum/app';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport UserFileList from './UserFileList';\n\nexport default class UploadsUserPage extends UserPage {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.user = null;\n\n    this.loadUser(m.route.param('username'));\n  }\n\n  content() {\n    if (app.session.user && (app.session.user.viewOthersMediaLibrary() || this.user === app.session.user)) {\n      return (\n        this.user &&\n        UserFileList.component({\n          user: this.user,\n          selectable: false,\n          downloadOnClick: true,\n        })\n      );\n    } else {\n      return null;\n    }\n  }\n\n  show(user) {\n    super.show(user);\n    this.user = user;\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\n\nimport Button from 'flarum/common/components/Button';\nimport Alert from 'flarum/common/components/Alert';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\n\nimport classList from 'flarum/common/utils/classList';\nimport extractText from 'flarum/common/utils/extractText';\n\nimport mimeToIcon from '../../common/mimeToIcon';\n\nexport default class UserFileList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    // Load file list\n    app.fileListState.setUser(vnode.attrs.user || app.session.user);\n\n    this.inModal = vnode.attrs.selectable;\n    this.restrictFileType = vnode.attrs.restrictFileType || null;\n    this.downloadOnClick = this.attrs.downloadOnClick || false;\n    /**\n     * @type {string[]} List of file UUIDs currently being hidden.\n     */\n    this.filesBeingHidden = [];\n\n    /**\n     * The user who's media we are dealing with\n     */\n    this.user = app.fileListState.user;\n  }\n\n  view() {\n    /**\n     * @type {{empty(): boolean, files: import('../../common/models/File').default[]}}\n     */\n    const state = app.fileListState;\n\n    return (\n      <div className=\"fof-upload-file-list\" aria-live=\"polite\">\n        {/* Loading */}\n        {state.isLoading() && state.files.length === 0 && (\n          <div className={'fof-upload-loading'}>\n            {app.translator.trans('fof-upload.forum.file_list.loading')}\n\n            <LoadingIndicator />\n          </div>\n        )}\n\n        {/* Empty personal file list */}\n        {this.inModal && state.empty() && (\n          <p className=\"fof-upload-empty\">\n            <i className=\"fas fa-cloud-upload-alt fof-upload-empty-icon\" />\n            {app.translator.trans(`fof-upload.forum.file_list.modal_empty_${app.screen() !== 'phone' ? 'desktop' : 'phone'}`)}\n          </p>\n        )}\n\n        {/* Empty file list */}\n        {!this.inModal && state.empty() && (\n          <div className=\"Placeholder\">\n            <p className=\"fof-upload-empty\">{app.translator.trans('fof-upload.forum.file_list.empty')}</p>\n          </div>\n        )}\n\n        {/* File list */}\n        <ul>\n          {state.files.map((file) => {\n            const fileIcon = mimeToIcon(file.type());\n            const fileSelectable = this.restrictFileType ? this.isSelectable(file) : true;\n\n            const fileClassNames = classList([\n              'fof-file',\n              // File is image\n              fileIcon === 'image' && 'fof-file-type-image',\n              // File is selected\n              this.attrs.selectedFiles && this.attrs.selectedFiles.indexOf(file.id()) >= 0 && 'fof-file-selected',\n            ]);\n\n            /**\n             * File's baseName (file name + extension)\n             * @type {string}\n             */\n            const fileName = file.baseName();\n\n            const isFileHiding = this.filesBeingHidden.includes(file.uuid());\n\n            return (\n              <li aria-busy={isFileHiding}>\n                {app.session.user && (this.user === app.session.user || app.session.user.deleteOthersMediaLibrary()) && (\n                  <Button\n                    className=\"Button Button--icon fof-file-delete\"\n                    icon=\"far fa-trash-alt\"\n                    aria-label={app.translator.trans('fof-upload.forum.file_list.delete_file_a11y_label', { fileName })}\n                    disabled={isFileHiding}\n                    onclick={this.hideFile.bind(this, file)}\n                  />\n                )}\n\n                <button\n                  className={fileClassNames}\n                  onclick={() => this.onFileClick(file)}\n                  disabled={!fileSelectable || isFileHiding}\n                  aria-label={extractText(app.translator.trans('fof-upload.forum.file_list.select_file_a11y_label', { fileName }))}\n                >\n                  <figure>\n                    {fileIcon === 'image' ? (\n                      <img\n                        src={file.url()}\n                        className=\"fof-file-image-preview\"\n                        draggable={false}\n                        // Images should always have an `alt`, even if empty!\n                        //\n                        // As we already state the file name as part of the\n                        // button alt label, there's no point in restating it.\n                        //\n                        // See: https://www.w3.org/WAI/tutorials/images/decorative#decorative-image-as-part-of-a-text-link\n                        alt=\"\"\n                      />\n                    ) : (\n                      <span\n                        className=\"fof-file-icon\"\n                        // Prevents a screen-reader from traversing this node.\n                        //\n                        // This is a placeholder for when no preview is available,\n                        // and a preview won't benefit a user using a screen\n                        // reader anyway, so there is no benefit to making them\n                        // aware of a lack of a preview.\n                        role=\"presentation\"\n                      >\n                        <i className={`fa-fw ${fileIcon}`} />\n                      </span>\n                    )}\n\n                    <figcaption className=\"fof-file-name\">{fileName}</figcaption>\n\n                    {isFileHiding && (\n                      <span class=\"fof-file-loading\" role=\"status\" aria-label={app.translator.trans('fof-upload.forum.file_list.hide_file.loading')}>\n                        <LoadingIndicator />\n                      </span>\n                    )}\n                  </figure>\n                </button>\n              </li>\n            );\n          })}\n        </ul>\n\n        {/* Load more files */}\n        {state.hasMoreResults() && (\n          <div className={'fof-load-more-files'}>\n            <Button className={'Button Button--primary'} disabled={state.isLoading()} loading={state.isLoading()} onclick={() => state.loadMore()}>\n              {app.translator.trans('fof-upload.forum.file_list.load_more_files_btn')}\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  /**\n   * Execute function on file click\n   *\n   * @param {import('../../common/models/File').default} file\n   */\n  onFileClick(file) {\n    // Custom functionality\n    if (this.attrs.onFileSelect) {\n      this.attrs.onFileSelect(file);\n      return;\n    }\n\n    // Download on click\n    if (this.attrs.downloadOnClick) {\n      window.open(file.url());\n      return;\n    }\n  }\n\n  /**\n   * Check if a file is selectable\n   *\n   * @param {import('../../common/models/File').default} file\n   */\n  isSelectable(file) {\n    const fileType = file.type();\n\n    // Custom defined file types\n    if (Array.isArray(this.restrictFileType)) {\n      return this.restrictFileType.indexOf(fileType) >= 0;\n    }\n\n    // Image\n    else if (this.restrictFileType === 'image') {\n      return fileType.includes('image/');\n    }\n\n    // Audio\n    else if (this.restrictFileType === 'audio') {\n      return fileType.includes('audio/');\n    }\n\n    // Video\n    else if (this.restrictFileType === 'video') {\n      return fileType.includes('video/');\n    }\n\n    return false;\n  }\n\n  /**\n   * Begins the hiding process for a file.\n   *\n   * - Shows a native confirmation dialog\n   * - If confirmed, sends AJAX request to the hide file API\n   *\n   * @param {import('../../common/models/File').default} file File to hide\n   */\n  hideFile(file) {\n    /**\n     * @type {string} File UUID\n     */\n    const uuid = file.uuid();\n\n    if (this.filesBeingHidden.includes(uuid)) return;\n\n    this.filesBeingHidden.push(uuid);\n\n    const confirmHide = confirm(\n      extractText(app.translator.trans('fof-upload.forum.file_list.hide_file.hide_confirmation', { fileName: file.baseName() }))\n    );\n\n    if (confirmHide) {\n      app\n        .request({\n          method: 'PATCH',\n          url: `${app.forum.attribute('apiUrl')}/fof/upload/hide`,\n          body: { uuid },\n        })\n        .then(() => {\n          app.alerts.show(Alert, { type: 'success' }, app.translator.trans('fof-upload.forum.file_list.hide_file.hide_success'));\n        })\n        .catch(() => {\n          app.alerts.show(\n            Alert,\n            { type: 'error' },\n            app.translator.trans('fof-upload.forum.file_list.hide_file.hide_fail', { fileName: file.fileName() })\n          );\n        })\n        .then(() => {\n          // Remove hidden file from state\n          /**\n           * @type {{ files: import('../../common/models/File').default[] }}\n           */\n          const state = app.fileListState;\n\n          const index = state.files.findIndex((file) => uuid === file.uuid());\n          state.files.splice(index, 1);\n\n          // Remove file from hiding list\n          const i = this.filesBeingHidden.indexOf(uuid);\n          this.filesBeingHidden.splice(i, 1);\n        });\n    } else {\n      // Remove file from hiding list\n      const i = this.filesBeingHidden.indexOf(uuid);\n      this.filesBeingHidden.splice(i, 1);\n    }\n  }\n}\n","import Uploader from '../handler/Uploader';\nimport DragAndDrop from './DragAndDrop';\nimport FileManagerButton from './FileManagerButton';\nimport FileManagerModal from './FileManagerModal';\nimport UserFileList from './UserFileList';\nimport UploadButton from './UploadButton';\n\nexport const components = {\n  DragAndDrop,\n  FileManagerButton,\n  FileManagerModal,\n  UserFileList,\n  Uploader,\n  UploadButton,\n};\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport Post from 'flarum/forum/components/Post';\n\n/* global $ */\n\nexport default function () {\n  extend(Post.prototype, 'oncreate', function () {\n    this.$('[data-fof-upload-download-uuid]')\n      .unbind('click')\n      .on('click', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!app.forum.attribute('fof-upload.canDownload')) {\n          alert(app.translator.trans('fof-upload.forum.states.unauthorized'));\n          return;\n        }\n\n        let url = app.forum.attribute('apiUrl') + '/fof/download';\n\n        url += '/' + encodeURIComponent(e.currentTarget.dataset.fofUploadDownloadUuid);\n        url += '/' + encodeURIComponent(this.attrs.post.id());\n        url += '/' + encodeURIComponent(app.session.csrfToken);\n\n        window.open(url);\n      });\n  });\n}\n","import app from 'flarum/forum/app';\n\nexport default class Uploader {\n  constructor() {\n    this.callbacks = {\n      success: [],\n      failure: [],\n      uploading: [],\n      uploaded: [],\n    };\n    this.uploading = false;\n  }\n\n  on(type, callback) {\n    this.callbacks[type].push(callback);\n  }\n\n  dispatch(type, response) {\n    this.callbacks[type].forEach((callback) => callback(response));\n  }\n\n  upload(files, addBBcode = true) {\n    this.uploading = true;\n    this.dispatch('uploading', files);\n\n    m.redraw(); // Forcing a redraw so that the button also updates if uploadFiles() is called from DragAndDrop or PasteClipboard\n\n    const body = new FormData();\n\n    for (let i = 0; i < files.length; i++) {\n      body.append('files[]', files[i]);\n    }\n\n    // send a POST request to the api\n    return app\n      .request({\n        method: 'POST',\n        url: app.forum.attribute('apiUrl') + '/fof/upload',\n        // prevent JSON.stringify'ing the form data in the XHR call\n        serialize: (raw) => raw,\n        body,\n      })\n      .then((result) => this.uploaded(result, addBBcode))\n      .catch((error) => {\n        this.uploading = false;\n        m.redraw();\n\n        const e = error.response.errors[0];\n\n        if (!e.code.includes('fof-upload')) {\n          throw error;\n        }\n\n        app.alerts.clear();\n        app.alerts.show(\n          {\n            type: 'error',\n          },\n          e.detail\n        );\n      });\n  }\n\n  uploaded(result, addBBcode = false) {\n    this.uploading = false;\n\n    result.data.forEach((file) => {\n      const fileObj = app.store.pushObject(file);\n\n      // Add file to media manager\n      app.fileListState.addToList(fileObj);\n\n      // Dispatch\n      this.dispatch('success', {\n        file: fileObj,\n        addBBcode,\n      });\n    });\n\n    this.dispatch('uploaded');\n  }\n}\n","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport UserPage from 'flarum/forum/components/UserPage';\nimport LinkButton from 'flarum/common/components/LinkButton';\n\nimport File from '../common/models/File';\nimport FileListState from './states/FileListState';\nimport downloadButtonInteraction from './downloadButtonInteraction';\nimport addUploadButton from './addUploadButton';\nimport UploadsUserPage from './components/UploadsUserPage';\nimport User from 'flarum/common/models/User';\nimport Model from 'flarum/common/Model';\n\nexport * from './components';\n\napp.initializers.add('fof-upload', () => {\n  User.prototype.viewOthersMediaLibrary = Model.attribute('fof-upload-viewOthersMediaLibrary');\n  User.prototype.deleteOthersMediaLibrary = Model.attribute('fof-upload-deleteOthersMediaLibrary');\n  User.prototype.uploadCountCurrent = Model.attribute('fof-upload-uploadCountCurrent');\n  User.prototype.uploadCountAll = Model.attribute('fof-upload-uploadCountAll');\n\n  addUploadButton();\n  downloadButtonInteraction();\n\n  // File model\n  app.store.models.files = File;\n\n  // File list state\n  app.fileListState = new FileListState();\n\n  // Add user uploads to the user profile\n  app.routes['user.uploads'] = {\n    path: '/u/:username/uploads',\n    component: UploadsUserPage,\n  };\n\n  // Add uploads to user page menu items\n  extend(UserPage.prototype, 'navItems', function (items) {\n    const canUpload = !!app.forum.attribute('fof-upload.canUpload');\n    const hasUploads = !!this.user.uploadCountCurrent();\n\n    if (app.session.user && (app.session.user.viewOthersMediaLibrary() || (this.user === app.session.user && (canUpload || hasUploads)))) {\n      const uploadCount = this.user.uploadCountCurrent();\n\n      items.add(\n        'uploads',\n        LinkButton.component(\n          {\n            href: app.route('user.uploads', {\n              username: this.user.slug(),\n            }),\n            name: 'uploads',\n            icon: 'fas fa-file-upload',\n          },\n          [\n            this.user === app.session.user\n              ? app.translator.trans('fof-upload.forum.buttons.media')\n              : app.translator.trans('fof-upload.forum.buttons.user_uploads'),\n            ' ',\n            uploadCount > 0 ? <span className=\"Button-badge\">{uploadCount}</span> : '',\n          ]\n        ),\n        80\n      );\n    }\n  });\n});\n","import app from 'flarum/forum/app';\n\nexport default class FileListState {\n  constructor() {\n    this.user = null;\n\n    this.files = [];\n\n    this.moreResults = false;\n\n    this.loading = false;\n  }\n\n  /**\n   * Set user and load list\n   *\n   * @param user A user to populate the media manager\n   */\n  setUser(user) {\n    // Keep previous state\n    if (user === this.user) return;\n\n    // Set user\n    this.user = user;\n\n    // Reset file list\n    this.files = [];\n\n    // Load user files\n    this.loadResults();\n  }\n\n  /**\n   * Load more user files\n   *\n   * @param offset The index to start the page at.\n   */\n  loadResults(offset = 0) {\n    if (!this.user) return;\n\n    this.loading = true;\n\n    return app.store\n      .find('fof/uploads', {\n        filter: {\n          user: this.user.id(),\n        },\n        page: {\n          offset,\n        },\n      })\n      .then(this.parseResults.bind(this));\n  }\n\n  /**\n   * Load the next page of discussion results.\n   */\n  loadMore() {\n    this.loading = true;\n\n    this.loadResults(this.files.length).then(this.parseResults.bind(this));\n  }\n\n  /**\n   * Parse results and append them to the file list.\n   */\n  parseResults(results) {\n    this.files.push(...results);\n\n    this.loading = false;\n    this.moreResults = !!results.payload.links && !!results.payload.links.next;\n\n    m.redraw();\n\n    return results;\n  }\n\n  /**\n   * Add files to the beginning of the list\n   */\n  addToList(files) {\n    if (Array.isArray(files)) {\n      this.files.unshift(...files);\n    } else {\n      this.files.unshift(files);\n    }\n  }\n\n  /**\n   * Are there any files in the list?\n   */\n  hasFiles() {\n    return this.files.length > 0;\n  }\n\n  /**\n   * Is the file list loading?\n   */\n  isLoading() {\n    return this.loading;\n  }\n\n  /**\n   * Does this user has more files?\n   */\n  hasMoreResults() {\n    return this.moreResults;\n  }\n\n  /**\n   * Does this user have any files?\n   */\n  empty() {\n    return !this.hasFiles() && !this.isLoading();\n  }\n}\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/Alert'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/LinkButton'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/components/Modal'];","module.exports = flarum.core.compat['common/components/TextEditor'];","module.exports = flarum.core.compat['common/components/Tooltip'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/models/User'];","module.exports = flarum.core.compat['common/utils/classList'];","module.exports = flarum.core.compat['common/utils/extractText'];","module.exports = flarum.core.compat['common/utils/mixin'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/Post'];","module.exports = flarum.core.compat['forum/components/UserPage'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/forum';\n"],"names":["image","archive","code","word","mimeToIcon","fileType","includes","indexOf","Model","mixin","File","apiEndpoint","exists","data","id","baseName","attribute","path","url","type","size","humanSize","createdAt","uuid","tag","hidden","bbcode","app","extend","TextEditor","UploadButton","DragAndDrop","PasteClipboard","Uploader","FileManagerButton","prototype","uploader","items","forum","composerButtonVisiblity","add","component","f_","vnode","on","file","addBBcode","attrs","composer","editor","getLastNChars","insertAtCursor","preview","originalIsFullScreen","isFullScreen","dragAndDropTarget","fofUploadDragAndDropTarget","dragAndDrop","files","upload","$","unload","parents","composerElement","handlers","supportsFileDragging","addEventListener","bind","out","dropping","div","document","createElement","window","removeEventListener","isNotFile","event","dataTransfer","i","length","kind","preventDefault","over","classList","remove","Component","Button","FileManagerModal","Tooltip","view","translator","trans","className","onclick","fileManagerButtonClicked","icon","e","modal","show","Modal","UserFileList","oninit","selectedFiles","multiSelect","restrictFileType","dragDrop","onUpload","oncreate","find","onremove","fileCount","fileListState","isLoading","alertAttrs","user","onFileSelect","hide","onSelect","itemPosition","splice","push","map","fileId","store","getById","element","paste","clipboardData","getAsFile","LoadingIndicator","reset","m","redraw","isMediaUploadButton","buttonText","uploading","uploadButtonClicked","disabled","process","prop","click","UserPage","UploadsUserPage","loadUser","route","param","content","session","viewOthersMediaLibrary","selectable","downloadOnClick","Alert","extractText","setUser","inModal","filesBeingHidden","state","empty","screen","fileIcon","fileSelectable","isSelectable","fileClassNames","fileName","isFileHiding","deleteOthersMediaLibrary","hideFile","onFileClick","hasMoreResults","loadMore","open","Array","isArray","confirmHide","confirm","request","method","body","then","alerts","index","findIndex","components","Post","unbind","stopPropagation","alert","encodeURIComponent","currentTarget","dataset","fofUploadDownloadUuid","post","csrfToken","callbacks","success","failure","uploaded","callback","dispatch","response","forEach","FormData","append","serialize","raw","result","error","errors","clear","detail","fileObj","pushObject","addToList","LinkButton","FileListState","downloadButtonInteraction","addUploadButton","User","initializers","uploadCountCurrent","uploadCountAll","models","routes","canUpload","hasUploads","uploadCount","href","username","slug","name","moreResults","loading","loadResults","offset","filter","page","parseResults","results","payload","links","next","unshift","hasFiles","setPrototypeOf","_inheritsLoose","subClass","superClass","Object","create","constructor","_setPrototypeOf","o","p","__proto__"],"sourceRoot":""}